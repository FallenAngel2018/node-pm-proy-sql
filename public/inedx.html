<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
  <title>Ingresar</title>
</head>

<body style="background-color: #CFD2CF;">
  <div class=" modal modal-signin position-static d-block py-5" tabindex="-1" role="dialog" id="modalSignin">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <!-- <h5 class="modal-title">Modal title</h5> -->
          <h2 class="fw-bold mb-0">Ingresa al sistema</h2>

        </div>

        <div class="modal-body p-5 pt-0">
          <form id="login_form" class="">

            <div id="login_error" style="display: none" class="alert alert-danger" role="alert">
            </div>

            <div class="form-floating mb-3">
              <!-- <input type="email" class="form-control rounded-3" id="floatingInput" name="cedula" -->
              <input type="text" class="form-control rounded-3" id="floatingInput" name="cedula"
                placeholder="Ejemplo: 0984562697">
              <label for="floatingInput">Cédula</label>
            </div>

            <div class="form-floating mb-3">
              <input type="password" class="form-control rounded-3" id="floatingPassword" name="clave"
                placeholder="********">
              <label for="floatingPassword">Contraseña</label>
            </div>

            <a href="dashboard.html">
              <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit">Ingresar</button>
            </a>
            <small class="text-muted">Asegurese de ingresar correctamente sus datos</small>
            <hr class="my-4">

          </form>

        </div>
      </div>
    </div>
  </div>
</body>

</html>


<script>
  
  // const BASE_URL = 'http://localhost:3000';
  // Producción
  const BASE_URL = 'https://node-pm-proy.herokuapp.com';
  const API_ENTITY = '/empleado';
  const API_METHOD = '/login';


  // #region jQuery - Document Ready y Submit

  const login_validation = async todo => {
      try {
        // const json = JSON.stringify({ cedula: "09228313911", clave: "jpiza" });
        const res = await axios.post(`${BASE_URL}${API_ENTITY}${API_METHOD}`, todo, {
          headers: {
            // Overwrite Axios's automatically set Content-Type
            'Content-Type': 'application/json'
          }
        });

        console.log("Login success?:", res.data.body)

        const login_success = res.data.body

        return login_success

      } catch (errors) {
        console.error(errors);
      }
  };

  // $(document).ready(function() {
  // });
  

  // Fuente: https://www.javatpoint.com/jquery-submit#:~:text=%E2%86%92%20%E2%86%90%20prev-,jQuery%20submit(),certain%20form%20elements%20have%20focus.
  // $( "form" ).submit(function( event ) {  
  $( "#login_form" ).submit(async function( event ) {  
      event.preventDefault();

      // Fuente para arreglar serializeArray() vacío
      // https://stackoverflow.com/questions/39808965/serializearray-gives-empty-array
      var form_data_array = $('#login_form').serializeArray() // o también .serialize()

      var values = {};
      $.each(form_data_array, function(i, field) {
      // $.each($('#login_form').serializeArray(), function(i, field) {
          values[field.name] = field.value;
      });

      console.log({ values })

      const login_success = await login_validation(values);
      console.log({ login_success })

      if(login_success) {
        window.location.href = "dashboard.html"
      } else {
        // Muestra el div que antes estaba oculto con display:none
        document.getElementById("login_error").style.display = "block";
        // Escribe el mensaje que tendrá el div
        document.getElementById("login_error").innerHTML = "Login Failed.";
      }

      // axios.post('/user', {
      //   firstName: 'Fred',
      //   lastName: 'Flintstone'
      // })
      // .then(function (response) {
      //   console.log(response);
      // })
      // .catch(function (error) {
      //   console.log(error);
      // });

  });


  // #endregion



  

</script>